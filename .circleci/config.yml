version: 2.1

# Define the jobs we want to run for this project
jobs:
  build:
    docker:
      - image: tqhuy1996developer/nodejs
    steps:
      - checkout
      - setup_remote_docker
      - restore_cache:
          keys:
          - v1-dependencies-{{ checksum "package.json" }}
          - v1-dependencies-
      - run:
        name: Install Nodejs packages
        command: |
          npm install
      - run:
        name: Start app
        command: |
          node index.js
      - restore_cache:
          keys:
          - v1-dependencies-{{ checksum "package.json" }}
          - v1-dependencies-
      - save_cache:
          paths:
            - node_modules
          key: v1-dependencies-{{ checksum "package.json" }}

# Orchestrate our job run sequence
workflows:
  build_nodejs:
    jobs:
      - build